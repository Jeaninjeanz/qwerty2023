View(riskData)
rData <- read.csv("~/Desktop/qwerty2023/data/raw/MorrisonData_cleaning.csv")
fData <- rData %>%
mutate(CURRENT.RATIO = as.numeric(CURRENT.RATIO)) %>%
mutate(PRICE.EARNINGS.RATIO = as.numeric(PRICE.EARNINGS.RATIO)) %>%
mutate(RETURN.ON.INVESTED.CAPITAL = as.numeric(RETURN.ON.INVESTED.CAPITAL)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.ASSET = as.numeric(TOTAL.DEBT.TO.TOTAL.ASSET)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(RETURN.ON.ASSET.RATIO = as.numeric(RETURN.ON.ASSET.RATIO)) %>%
mutate(Date = as.Date(Date))
fData
summary(fData)
fData_NA_rm <- fData %>%
drop_na()
print("------------------------------------------------------------------------------------------------------")
summary(fData_NA_rm)
View(fData_NA_rm)
fData_NA_rm_2 <- fData_NA_rm %>%
mutate(risk1 = case_when(fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "2",
fData_NA_rm$`CURRENT.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "1")) %>%
mutate(risk2 = case_when(fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[2],-8)) ~ "1",
fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "2",
fData_NA_rm$`PRICE.EARNINGS.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "3")) %>%
mutate(risk3 = case_when(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`<= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`> as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "1")) %>%
mutate(risk4 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "3")) %>%
mutate(risk5 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "3")) %>%
mutate(risk6 = case_when(fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "1")) %>%
mutate(risk1 = as.numeric(risk1)) %>%
mutate(risk2 = as.numeric(risk2)) %>%
mutate(risk3 = as.numeric(risk3)) %>%
mutate(risk4 = as.numeric(risk4)) %>%
mutate(risk5 = as.numeric(risk5)) %>%
mutate(risk6 = as.numeric(risk6)) %>%
mutate(year = year(Date))
fData_categories <- fData_NA_rm_2 %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2, risk3, risk4, risk5, risk6))))
head(fData_categories)
fData_categories_final <- fData_categories %>%
summarise(meancat = mean(category), .groups = 'drop')
fData_categories_final <- fData_categories_final %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "High"))
fData_categories_final
fData_categories_final <- fData_categories %>%
select(everything()) %>%
summarise(meancat = mean(category), .groups = 'drop')
fData_categories_final <- fData_categories_final %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "High"))
fData_categories_final
fData2_categories2 <- fData_NA_rm_2 %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2, risk3, risk4, risk5, risk6))))
head(fData2_categories2)
fData_categories_final3 <- fData2_categories2 %>%
select(everything()) %>%
mutate(meancat = (risk1 + risk2 + risk3 + risk4 + risk5 + risk6)/6 )
fData_categories_final3 <- fData_categories_final3 %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final3$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final3$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final3$`meancat`)[5],-8)) ~ "High"))
fData_categories_final3
library(tidyverse)
library(readr)
library(lubridate)
rData <- read.csv("~/Desktop/qwerty2023/data/raw/MorrisonData_cleaning.csv")
fData <- rData %>%
mutate(CURRENT.RATIO = as.numeric(CURRENT.RATIO)) %>%
mutate(PRICE.EARNINGS.RATIO = as.numeric(PRICE.EARNINGS.RATIO)) %>%
mutate(RETURN.ON.INVESTED.CAPITAL = as.numeric(RETURN.ON.INVESTED.CAPITAL)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.ASSET = as.numeric(TOTAL.DEBT.TO.TOTAL.ASSET)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(RETURN.ON.ASSET.RATIO = as.numeric(RETURN.ON.ASSET.RATIO)) %>%
mutate(Date = as.Date(Date))
fData
summary(fData)
fData_NA_rm <- fData %>%
drop_na()
print("------------------------------------------------------------------------------------------------------")
summary(fData_NA_rm)
fData_NA_rm_2 <- fData_NA_rm %>%
mutate(risk1 = case_when(fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "2",
fData_NA_rm$`CURRENT.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "1")) %>%
mutate(risk2 = case_when(fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[2],-8)) ~ "1",
fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "2",
fData_NA_rm$`PRICE.EARNINGS.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "3")) %>%
mutate(risk3 = case_when(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`<= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`> as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "1")) %>%
mutate(risk4 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "3")) %>%
mutate(risk5 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "3")) %>%
mutate(risk6 = case_when(fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "1")) %>%
mutate(risk1 = as.numeric(risk1)) %>%
mutate(risk2 = as.numeric(risk2)) %>%
mutate(risk3 = as.numeric(risk3)) %>%
mutate(risk4 = as.numeric(risk4)) %>%
mutate(risk5 = as.numeric(risk5)) %>%
mutate(risk6 = as.numeric(risk6)) %>%
mutate(year = year(Date))
fData_categories <- fData_NA_rm_2 %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2, risk3, risk4, risk5, risk6))))
head(fData_categories)
fData_categories_final <- fData_categories %>%
summarise(meancat = mean(category), .groups = 'drop')
fData_categories_final <- fData_categories_final %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "High"))
fData_categories_final
summary(fData_categories_final)
table(fData_categories_final$category1)
saveRDS(fData_categories_final, "~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
fData2_categories2 <- fData_NA_rm_2 %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2, risk3, risk4, risk5, risk6))))
head(fData2_categories2)
fData_categories_final3 <- fData2_categories2 %>%
select(everything()) %>%
mutate(meancat = (risk1 + risk2 + risk3 + risk4 + risk5 + risk6)/6 )
fData_categories_final3 <- fData_categories_final3 %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final3$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final3$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final3$`meancat`)[5],-8)) ~ "High"))
head(fData_categories_final3)
saveRDS(fData_categories_final3, "~/Desktop/qwerty2023/data/cleaned/FundamentalDataCleaned.rds")
riskData <- read_rds("~/Desktop/qwerty2023/data/cleaned/FundamentalDataCleaned.rds")
View(riskData)
library(tidyverse)
library(readr)
library(lubridate)
rData <- read.csv("~/Desktop/qwerty2023/data/raw/MorrisonData_cleaning.csv")
fData <- rData %>%
mutate(CURRENT.RATIO = as.numeric(CURRENT.RATIO)) %>%
mutate(PRICE.EARNINGS.RATIO = as.numeric(PRICE.EARNINGS.RATIO)) %>%
mutate(RETURN.ON.INVESTED.CAPITAL = as.numeric(RETURN.ON.INVESTED.CAPITAL)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.ASSET = as.numeric(TOTAL.DEBT.TO.TOTAL.ASSET)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(TOTAL.DEBT.TO.TOTAL.EQUITY = as.numeric(TOTAL.DEBT.TO.TOTAL.EQUITY)) %>%
mutate(RETURN.ON.ASSET.RATIO = as.numeric(RETURN.ON.ASSET.RATIO)) %>%
mutate(Date = as.Date(Date))
fData
summary(fData)
fData_NA_rm <- fData %>%
drop_na()
print("------------------------------------------------------------------------------------------------------")
summary(fData_NA_rm)
fData_NA_rm_2 <- fData_NA_rm %>%
mutate(risk1 = case_when(fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`CURRENT.RATIO`< as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "2",
fData_NA_rm$`CURRENT.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`CURRENT.RATIO`)[4],-8))~ "1")) %>%
mutate(risk2 = case_when(fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[2],-8)) ~ "1",
fData_NA_rm$`PRICE.EARNINGS.RATIO`< as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "2",
fData_NA_rm$`PRICE.EARNINGS.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`PRICE.EARNINGS.RATIO`)[4],-8))~ "3")) %>%
mutate(risk3 = case_when(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`<= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`> as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.INVESTED.CAPITAL`)[4],-8))~ "1")) %>%
mutate(risk4 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.ASSET`)[4],-8))~ "3")) %>%
mutate(risk5 = case_when(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[2],-8)) ~ "1",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`< as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "2",
fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`>= as.numeric(substring(summary(fData_NA_rm$`TOTAL.DEBT.TO.TOTAL.EQUITY`)[4],-8))~ "3")) %>%
mutate(risk6 = case_when(fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[2],-8)) ~ "3",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`< as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "2",
fData_NA_rm$`RETURN.ON.ASSET.RATIO`>= as.numeric(substring(summary(fData_NA_rm$`RETURN.ON.ASSET.RATIO`)[4],-8))~ "1")) %>%
mutate(risk1 = as.numeric(risk1)) %>%
mutate(risk2 = as.numeric(risk2)) %>%
mutate(risk3 = as.numeric(risk3)) %>%
mutate(risk4 = as.numeric(risk4)) %>%
mutate(risk5 = as.numeric(risk5)) %>%
mutate(risk6 = as.numeric(risk6)) %>%
mutate(year = year(Date))
fData_categories <- fData_NA_rm_2 %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2, risk3, risk4, risk5, risk6))))
head(fData_categories)
fData_categories_final <- fData_categories %>%
summarise(meancat = mean(category), .groups = 'drop')
fData_categories_final <- fData_categories_final %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "Medium",
meancat > as.numeric(substring(summary(fData_categories_final$`meancat`)[5],-8)) ~ "High"))
fData_categories_final
summary(fData_categories_final)
table(fData_categories_final$category1)
saveRDS(fData_categories_final, "~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
library(tidyverse)
library(dplyr)
library(readr)
library(lubridate)
library(ggplot2)
library(factoextra)
library(caret)
sNpData <- read_csv("~/Desktop/qwerty2023/data/raw/all_stocks_5yrs.csv")
sNpData <- na.omit(sNpData)
sNpData$date <- ymd(sNpData$date)
head(sNpData)
#filtered to reduce datapoints while testing
fData <- drop_na(sNpData)
fData
#Finding the average price and creating a column
fData <- fData %>% mutate(averagePrice = (open+close)/2)
#count number of years in the dataset to make code neater + automation
fData <- fData %>%
group_by(Name) %>%
mutate(yearAvg = (sum(averagePrice))/(365.25*5)) %>%
mutate(yearVolumeAvg = (sum(volume))/(365.25*5))
fData
fData <- fData %>%
group_by(Name) %>%
mutate(averagePrice = sum(((averagePrice - yearAvg)^2))) %>%
mutate(averageVolume = sum(((volume - yearVolumeAvg)^2)))
#varience
fData <- fData %>%
group_by(Name) %>%
mutate(varience = (averagePrice/(365.25*5))) %>%
mutate(volumeVarience = (averageVolume/(365.25*5)))
fData
#calculating the standard deviation
fData <- fData %>%
group_by(Name) %>%
mutate(SD = sqrt(varience)) %>%
mutate(SDvolume = sqrt(volumeVarience))
fData
summary(fData$SDvolume)
fData2 <- fData %>%
ungroup() %>%
mutate(risk1 = case_when(fData$`SD`< as.numeric(substring(summary(fData$`SD`)[2],-8)) ~ "1",
fData$`SD`< as.numeric(substring(summary(fData$`SD`)[4],-8))~ "2",
fData$`SD`>= as.numeric(substring(summary(fData$`SD`)[4],-8))~ "3")) %>%
mutate(risk2 = case_when(fData$`SDvolume`< as.numeric(substring(summary(fData$`SDvolume`)[2],-8)) ~ "1",
fData$`SDvolume`< as.numeric(substring(summary(fData$`SDvolume`)[4],-8))~ "2",
fData$`SDvolume`>= as.numeric(substring(summary(fData$`SDvolume`)[4],-8))~ "3")) %>%
mutate(risk1 = as.numeric(risk1)) %>%
mutate(risk2 = as.numeric(risk2)) %>%
mutate(year = year(date))
fData3 <- fData2 %>%
mutate(riskAvg = (risk1 + risk2)/2 )
fData3 <- fData3 %>%
mutate(riskClass = case_when(riskAvg < as.numeric(substring(summary(fData3$`riskAvg`)[2],-8)) ~ "Low",
riskAvg < as.numeric(substring(summary(fData3$`riskAvg`)[5],-8)) ~ "Medium",
riskAvg >= as.numeric(substring(summary(fData3$`riskAvg`)[5],-8)) ~ "High"))
summary(fData3$riskAvg)
table(fData3$riskClass)
saveRDS(fData3,"~/Desktop/qwerty2023/data/cleaned/riskData.rds")
fData_categories <- fData2 %>%
select( year, Name, risk1, risk2) %>%
group_by(Name) %>%
mutate(category = (mean(c(risk1, risk2))))
fData_categories_final <- fData_categories %>%
summarise(mean = mean(category), .groups = 'drop')
fData_categories_final <- fData_categories_final %>%
mutate(historicalRisk = case_when(mean <= as.numeric(substring(summary(fData_categories_final$`mean`)[2],-8))~ "Low",
mean <= as.numeric(substring(summary(fData_categories_final$`mean`)[5],-8)) ~ "Medium",
mean > as.numeric(substring(summary(fData_categories_final$`mean`)[5],-8)) ~ "High"))
summary(fData_categories_final)
table(fData_categories_final$historicalRisk)
fData_categories_final
saveRDS(fData_categories_final,"~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
fundamentalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalData.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
View(fundamentalData)
View(historicalData)
joined <- left_join(fundamentalData,historicalData,by=Name)
joined <- left_join(fundamentalData,historicalData,by=$Name)
joined <- left_join(fundamentalData,historicalData,by="Name")
View(joined)
joined <- inner_join(fundamentalData,historicalData,by="Name")
joined <- left_join(fundamentalData,historicalData,by="Name")
View(joined)
joined <- inner_join(fundamentalData,historicalData,by="Name")
joined1 <- fundamentalData %>%
mutate(historicalrisk = historicalData$category1)
joined1
joined1 <- historicalData %>%
mutate(historicalrisk = historicalData$category1)
joined1
names <- inner_join(fundamentalData,historicalData,"Name")
View(names)
names <- left_join(fundamentalData,historicalData,"Name")
View(names)
fundamentalData
historicalData
fundamentalData
historicalData
names <- right_join(fundamentalData,historicalData,"Name")
names <- join_by(fundamentalData,historicalData,"Name")
names <- merge(data_frame(fundamentalData),data_frame(historicalData),"Name")
View(names)
names <- merge(data_frame(fundamentalData, row.names=NULL),data_frame(historicalData, row.names=NULL),by=0, all = TRUE)[-1]
View(names)
names <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by=0, all = TRUE)[-1]
names <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by=0, all = TRUE)
names <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by="Names", all = TRUE)
names <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by="Name", all = TRUE)
merged <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by="Name", all = TRUE)
merged <- drop_na(merged)
View(names)
merged <- left_join(data_frame(historicalData),data_frame(fundamentalData),by="Name")
View(merged)
merge <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by="Name", all = TRUE)
fundamentalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
merge <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by="Name", all = TRUE)[-1]
View(merge)
merge <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by=0, all = TRUE)[-1]
View(merge)
View(fundamentalData)
View(historicalData)
fundamentalData %>%
left_join(historicalData)
fundamentalData %>%
left_join(historicalData,
by = "Name")
library(tidyverse)
fundamentalData %>%
left_join(historicalData,
by = "Name")
fundamentalData %>%
full_join(historicalData,
by = "Name")
View(fundamentalData)
fundamentalData
historicalData
fundamentalData %>%
left_join(historicalData,
by = "Name")
historicalData
fundamentalData %>%
left_join(historicalData,
by = "Name")
merge <- merge(data_frame(historicalData, row.names=NULL),data_frame(fundamentalData, row.names=NULL),by=0, all = TRUE)[-1]
merge
fundamentalData
historicalData
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
fundamentalData %>%
left_join(historicalData,
by = "Name")
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
merged <- fundamentalData %>%
left_join(historicalData,
by = "Name")
merged
merged <- historicalData %>%
left_join(fundamentalData,
by = "Name")
merged
merged
merged <- merged %>%
select(-historicalRisk, - category1)
merged <- merged %>%
select(-historicalRisk, - category1)
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
merged <- historicalData %>%
left_join(fundamentalData,
by = "Name")
merged
merged1 <- merged %>%
select(-historicalRisk, - category1)
merged1
merged1 <- merged1 %>%
mutate(finalRisk = (mean + meancat)/2)
merged1
summary(merged1$finalRisk)
summary(merged1$finalRisk)
table(merged1$finalRisk)
merged1 <- merged1 %>%
summarise(meancat = mean(category), .groups = 'drop')
merged1 <- merged1 %>%
mutate(category1 = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat > as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
merged1 <- merged1 %>%
mutate(categoryLevel = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat > as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
summary(merged1$categoryLevel)
table(merged1$categoryLevel)
merged1 <- merged1 %>%
mutate(categoryLevel = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat < as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat >= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
summary(merged1$categoryLevel)
table(merged1$categoryLevel)
summary(merged1)
table(merged1$categoryLevel)
library(tidyverse)
fundamentalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
merged <- historicalData %>%
left_join(fundamentalData,
by = "Name")
merged
merged1 <- merged %>%
select(-historicalRisk, - category1)
merged1
merged1 <- merged1 %>%
mutate(finalRisk = (mean + meancat)/2)
merged1
merged1 <- merged1 %>%
mutate(categoryLevel = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat < as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat >= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
summary(merged1)
table(merged1$categoryLevel)
View(historicalData)
merged1 <- merged1 %>%
mutate(historicalRisk = mean) %>%
mutate(fundamentalRisk = meancat) %>%
select(Name, categoryLevel, historicalRisk, fundamentalRisk)
merged1
merged1 <- merged1 %>%
mutate(historicalRisk = mean) %>%
mutate(fundamentalRisk = meancat) %>%
select(Name, categoryLevel, historicalRisk, fundamentalRisk)
View(merged1)
saveRDS(merged1, "~/Desktop/qwerty2023/data/cleaned/FinalRisk.rds")
library(tidyverse)
fundamentalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
merged <- historicalData %>%
left_join(fundamentalData,
by = "Name")
merged
merged1 <- merged %>%
select(-historicalRisk, - category1)
merged1
merged1 <- merged1 %>%
mutate(finalRisk = (mean + meancat)/2)
merged1
merged1 <- merged1 %>%
mutate(categoryLevel = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat < as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat >= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
summary(merged1)
table(merged1$categoryLevel)
merged2 <- merged1 %>%
mutate(historicalRisk = mean) %>%
mutate(fundamentalRisk = meancat) %>%
select(Name, categoryLevel, historicalRisk, fundamentalRisk)
merged2
saveRDS(merged1, "~/Desktop/qwerty2023/data/cleaned/FinalRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
View(historicalData)
library(tidyverse)
fundamentalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/FundamentalCompanyRisk.rds")
historicalData <- readRDS("~/Desktop/qwerty2023/data/cleaned/HistoricalRisk.rds")
#weights
hWeight = 0.4
fWeight = 0.6
fundamentalData$Name <- stringr::str_trim(fundamentalData$Name)
historicalData$Name <- stringr::str_trim(historicalData$Name)
merged <- historicalData %>%
left_join(fundamentalData,
by = "Name")
merged
merged1 <- merged %>%
select(-historicalRisk, - category1)
merged1
merged1 <- merged1 %>%
mutate(finalRisk = (hWeight * mean + fWeight * meancat))
merged1
merged1 <- merged1 %>%
mutate(categoryLevel = case_when(meancat <= as.numeric(substring(summary(merged1$`finalRisk`)[2],-8))~ "Low",
meancat < as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "Medium",
meancat >= as.numeric(substring(summary(merged1$`finalRisk`)[5],-8))~ "High"))
merged1
summary(merged1)
table(merged1$categoryLevel)
merged2 <- merged1 %>%
mutate(historicalRisk = mean) %>%
mutate(fundamentalRisk = meancat) %>%
select(Name, categoryLevel, historicalRisk, fundamentalRisk)
merged2
#saveRDS(merged1, "~/Desktop/qwerty2023/data/cleaned/FinalRisk.rds")
saveRDS(merged1, "~/Desktop/qwerty2023/data/cleaned/FinalRisk.rds")
